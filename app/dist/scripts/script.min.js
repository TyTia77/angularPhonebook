"use strict";var app=angular.module("myApp",["ngRoute"]);app.config(["$routeProvider","$locationProvider",function(t,e){t.when("/",{templateUrl:"app/view/address-book.html",controller:"addressCtrl"}).otherwise({redirectTo:"/"})}]),app.directive("customDialog",[function(){return{restrict:"E",scope:{headerTitle:"=",class:"="},transclude:{body:"?dialogBody",footer:"?dialogFooter"},templateUrl:"app/view/custom-directives/custom-dialog.html",controller:"@",name:"controller"}}]),app.service("validateService",["$rootScope",function(t){this.email=function(t){var e=/\S+@\S+\.\S+/;return void 0===t||""===t||e.test(t)},this.text=function(t){var e=/^[a-zA-Z\s]+$/;return void 0!==t&&""!==t&&e.test(t)},this.num=function(t){var e=/^[0-9]+$/;return void 0===t||""===t||!(t.length<10)&&e.test(t)},this.errorMsgTemplate=function(){return{firstname:{msg:"Only letters and is required",display:!1},lastname:{msg:"Only letters and is required",display:!1},email:{msg:"Invalid Email, Please try again",display:!1},mobile:{msg:"Only numbers allowed and 10digits",display:!1}}}}]),app.service("myService",["$rootScope",function(t){var e=["#db4540","#384c7a","#6cde9b","#b07142","#b771e0","#e6d698"];this.getColours=function(t){return e[t]};var n="first_name";this.getSortByValue=function(){return n},this.setSortByValue=function(e){n=e,t.$emit("sortByChange",e)};this.setContactList=function(t){this.contactList=t},this.getContactList=function(t){if(!t)return this.contactList;for(var e in this.contactList)if(this.contactList[e].id==t)return this.contactList[e]},this.updateContactInstanceState=function(){t.$emit("toggleDialogContact",{})},this.checkOpenState=function(t){t?$(".container").attr("faded",!0):$(".container").removeAttr("faded")}}]),app.factory("myFactory",["$http",function(t){var e="http://60.242.62.79:5000/contacts",n={};return n.getContacts=function(){return t.get(e)},n.insertContact=function(n){return t.post(e,n)},n.updateContact=function(n,o){return t.put(e+"/"+n,o)},n.deleteContact=function(n){return t.delete(e+"/"+n)},n}]),app.factory("buttonFactory",["$rootScope",function(t){function e(t){this.active=t||!1}return e.prototype.getState=function(){return this.active},e.prototype.setState=function(t){this.active=t},{new:e}}]),app.controller("addressCtrl",["$rootScope","$scope","$location","myFactory","myService","buttonFactory",function(t,e,n,o,a,i){function c(){o.getContacts().then(function(t){var n=t.data.contactList,o=0;n.forEach(function(t){var e=t.first_name[0].toUpperCase(),i=t.last_name[0].toUpperCase(),c=Math.floor(6*Math.random());n[o].initials=e+i,n[o].colour=a.getColours(c),o++}),a.setContactList(n),e.contactList=a.getContactList(),setTimeout(function(){l()},1)},function(t){console.log(t)})}c(),e.sortByValue=a.getSortByValue(),e.toggleSettingDialog=function(){t.$emit("toggleDialogSetting",{})},e.toggleAddNewDialog=function(){t.$emit("toggleDialogAddNew",{})},e.toggleContactDialog=function(e){t.$emit("toggleDialogContact",e)},t.$on("sortByChange",function(t,n){e.sortByValue=n}),t.$on("refreshContactList",function(){c()});var l=function(){try{var t=$(".listview-header")||!1,e=t[0].clientWidth,n=$(".listview")[0].clientWidth;if(e>n){var o=-Math.abs(e-n);t.css("left",o+"px")}else t.css("left","0px")}catch(t){console.log(t)}}}]),app.controller("dialogAddNewCtrl",["$scope","$rootScope","myFactory","myService","buttonFactory","validateService",function(t,e,n,o,a,i){function c(e){for(var n in e)e[n]?($("input[name="+n+"]")[0].classList.remove("notvalid"),t.error[n].display=!1):($("input[name="+n+"]")[0].classList.add("notvalid"),t.error[n].display=!0)}function l(o){n.insertContact(o).then(function(n){console.log("succesfully inserted"),t.handleNewContactClearAllClick(),e.$emit("refreshContactList",{})},function(t){console.log(t)})}t.openState=!1,t.newContact={},t.error=i.errorMsgTemplate(),t.newContactClearAll=new a.new,t.newContactSubmit=new a.new,e.$on("toggleDialogAddNew",function(){t.toggle()}),t.toggle=function(){t.openState=!t.openState,o.checkOpenState(t.openState)},t.handleKeyUp=function(e){var n={};console.log(e),(e.first_name||""===e.first_name)&&(n.firstname=i.text(e.first_name)),(e.last_name||""===e.last_name)&&(n.lastname=i.text(e.last_name)),(e.phone_mob||""===e.phone_mob)&&(n.mobile=i.num(e.phone_mob)),(e.email||""===e.email)&&(n.email=i.email(e.email)),console.log(n),c(n),t.handleNewContactClearAllValidate(),t.handleNewContactSubmitValidate()},t.handleNewContactClearAllValidate=function(){console.log(t.newContact);for(var e in t.newContact)if(t.newContact[e].length>0)return void t.newContactClearAll.setState(!0);t.newContactClearAll.setState(!1)},t.handleNewContactClearAllClick=function(){for(var e in t.newContact)delete t.newContact[e];for(var n in t.error)t.error[n].display=!1;var o=$(".notvalid");for(var a in o)void 0!==o[a].classList&&o[a].classList.remove("notvalid");t.newContactClearAll.active=!1,t.newContactSubmit.active=!1},t.handleNewContactSubmitValidate=function(){var e=t.newContact,n=$(".notvalid");return e.first_name&&e.last_name&&0===n.length?(t.newContactSubmit.setState(!0),!0):(t.newContactSubmit.setState(!1),!1)},t.handleNewContactSubmitClick=function(){l(t.newContact),t.newContactSubmit.active=!1}}]),app.controller("dialogContactCtrl",["$scope","$rootScope","myFactory","myService","buttonFactory",function(t,e,n,o,a){function i(e){t.contactDetail=o.getContactList(e),s=JSON.parse(JSON.stringify(t.contactDetail))}function c(e){var n={};for(var o in e)switch(o){case"$$hashKey":case"colour":case"initials":break;default:n[o]=e[o]}r(n),t.editMode=!t.editMode,i(n.id),t.buttonSave.setState(!1)}function l(a){n.deleteContact(a).then(function(n){console.log("successfully deleted"),t.editMode=!t.editMode,o.updateContactInstanceState(),e.$emit("refreshContactList",{})},function(t){console.log(t)})}function r(t){n.updateContact(t.id,t).then(function(t){console.log("succesfully inserted")},function(t){console.log(t)})}t.openState=!1,t.editMode=!1,t.buttonEdit=new a.new(!0),t.buttonCancel=new a.new(!0),t.buttonDelete=new a.new(!0),t.buttonSave=new a.new;var s;t.handleButtonEditClick=function(){t.editMode=!t.editMode},t.handleButtonCancelClick=function(){t.contactDetail=JSON.parse(JSON.stringify(s)),t.editMode=!t.editMode,t.buttonSave.setState(!1)},t.handleButtonDeleteClick=function(t){l(t)},t.handleButtonSaveClick=function(t){c(t)},e.$on("toggleDialogContact",function(e,n){n&&i(n),t.toggle()}),t.toggle=function(){t.openState=!t.openState,o.checkOpenState(t.openState),t.editMode&&(t.editMode=!t.editMode)},t.handleInput=function(){var e=t.contactDetail;console.log(e),console.log(s);for(var n in e){if(e[n]!=s[n])return void t.buttonSave.setState(!0);t.buttonSave.setState(!1),e[n]}}}]),app.controller("dialogSettingCtrl",["$scope","$rootScope","myFactory","myService","buttonFactory",function(t,e,n,o,a){t.openState=!1,t.settingApply=new a.new,t.sortByValue=o.getSortByValue();var i="first_name";t.toggle=function(){t.openState=!t.openState,o.checkOpenState(t.openState)},t.handleSettingValidate=function(e){e!=i&&t.settingApply.setState(!0)},t.handleSettingSubmit=function(){o.setSortByValue($("#sortby").val()),t.sortByValue=$("#sortby").val(),t.settingApply.setState(!1),i=$("#sortby").val()},e.$on("toggleDialogSetting",function(){t.toggle()})}]);